# ENG-API — Minimal Engine Interface Specification (Rewritten v8)
Status: FROZEN (v8 – Single-Area Runtime & Degraded Mode)
Applies to: Engine Core (V1/V2+)
Scope: Deterministic, storage-agnostic engine interface, including degraded mode and receipt enforcement

Authority: Subordinate to ENG-DOMAIN, ENG-ERROR, ENG-CORE-PURITY, ENG-REVIEW-RETIRED, ENG-SUPERSESSION, ENG-RECEIPT, ENG-INTEGRITY

---

# 1. Purpose

ENG-API defines the minimal deterministic interface between a host (CLI or other caller) and the Engine Core.

The Engine:

- Operates exclusively on canonical domain objects  
- Operates on exactly one Area at a time  
- Generates all UUIDv7 identifiers internally  
- Emits structured EvaluationReports for every command  
- Emits audit events separately (append-only)  
- Emits immutable session receipts at structural closure  
- Enforces governance slot invariants at command boundary  
- Never manages storage, indexing, import, or export internally  

Legitimacy is created only via session acceptance.

Receipts formalize closure and are engine-authoritative artifacts.

Bootstrap is not a special API; Authority initialization occurs through standard session mechanics.

Degraded read-only mode allows the engine to expose the DAG for export if structural integrity or receipts are compromised.

---

# 2. Global Rules

## ENG-API-00 — Single-Area Runtime Model

An Engine instance operates on exactly one Area at a time.

- Must not host multiple Areas simultaneously  
- Must not evaluate legitimacy across Areas  
- Must not retain legitimacy state from a previously loaded Area once a new Area is rehydrated  

Area switching is the responsibility of the host (CLI):

- Persist current Area state externally  
- Call `rehydrate_engine` with a new Area graph  

Analogy: **git checkout** for Area state:

- Engine loads one Area at a time  
- Operates exclusively within it  
- Discards prior Area state on rehydration  

Cross-area orchestration is strictly outside the Engine boundary.

---

## ENG-API-01 — Deterministic Command Reporting

- Every mutating API call returns exactly one EvaluationReport  
- Read-only API calls return deterministic snapshots  

The Engine must not:

- Throw semantic exceptions  
- Return booleans for legitimacy  
- Encode meaning in narrative strings  

All outcomes are structured and machine-readable.

---

## ENG-API-02 — UUID Ownership

All IDs are UUIDv7 generated by the Engine:

- session_id  
- candidate_id  
- resolution_id  
- evaluation_id  
- vote_id  
- receipt_id  

Callers may reference existing IDs but may **not** generate them.

IDs are valid only within the currently loaded Area.

---

# 3. Degraded / Read-Only Mode

## ENG-API-03 — Degraded Mode Activation

The Engine may enter **degraded read-only mode** if:

- Receipt integrity cannot be proven  
- Structural invariants are violated but non-repairable  

In degraded mode:

- Only read operations and DAG export are permitted  
- Mutating commands fail deterministically with `DEGRADED_MODE_ACTIVE`  
- EvaluationReports indicate outcome = REJECTED, error_code = DEGRADED_MODE_ACTIVE, block_type = PERMANENT  

---

## ENG-API-04 — DAG Export

When in degraded mode, the host may request an Area DAG export:

- Provides complete domain graph and structural metadata  
- Excludes cross-area references  
- Output is deterministic and sufficient for host-mediated consolidation or rehydration  

Export does **not** affect Engine state or receipts.

---

# 4. Engine Rehydration & Status

## ENG-API-05 — rehydrate_engine

Load a complete domain graph for a single Area into memory.

Inputs:

- Domain objects belonging to exactly one Area  
  - sessions  
  - candidates  
  - votes  
  - resolutions  
  - scopes  
  - receipts  
  - annotations  

Behavior:

- Replaces any previously loaded Area state  
- Validates structural integrity  
- Validates governance slot exclusivity  
- Validates supersession graph  
- Validates receipt integrity  
- Validates participant sets  
- Enforces BLOCK_PERMANENT hygiene  
- Derives Area governance state (not stored)  

Outcome:

- Success → Engine enters normal runtime mode  
- Failure → Engine halts (hard structural failure) or enters **degraded mode** if integrity is compromised but DAG export is possible  

Fail if:

- Objects from multiple Areas are supplied  
- Multiple ACTIVE Authority in the Area  
- Multiple ACTIVE Scope in the Area  
- Required slot missing given existing sessions  
- Receipt content_hash mismatch  
- Structural invariant violated  

---

## ENG-API-06 — Status Queries

- Host may query the Engine for:

  - Current Area ID  
  - ACTIVE Authority and Scope  
  - Session states  
  - Supersession graph summary  
  - Receipt existence and integrity  
  - Degraded mode flag  

Status queries are always permitted, even in degraded mode.

---

# 5. Mental Model

- Engine operates as a deterministic legitimacy compiler  
- Receipts attest to what was compiled  
- Missing or tampered receipts prevent mutating operations  
- Degraded mode enables export of DAG for host-driven consolidation  
- Mutations in degraded mode are strictly prohibited  
- Cross-area coordination is outside Engine responsibility  

---

# 6. Guarantees

- Deterministic EvaluationReports for all commands  
- Single-Area runtime enforcement  
- Immutable receipts for CLOSED/ACCEPTED sessions  
- Governance slot invariants enforced at command boundary  
- Hard structural failures halt Engine or trigger degraded mode  
- DAG export enables recovery without violating integrity