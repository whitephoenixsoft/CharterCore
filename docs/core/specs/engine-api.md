# ENG-API — Minimal Engine Interface Specification
Status: FROZEN (v6 – Evaluation Purity & Idempotence Formalized)
Applies to: Engine Core (V1/V2+)
Scope: Deterministic, storage-agnostic engine interface

Authority: Subordinate to ENG-DOMAIN, ENG-ERROR, ENG-CORE-PURITY, ENG-REVIEW-RETIRED, ENG-SUPERSESSION, ENG-RECEIPT, ENG-INTEGRITY

---

# 1. Purpose

ENG-API defines the minimal deterministic interface between a host (CLI or other caller) and the Engine Core.

The Engine:

- Operates only on canonical domain objects
- Generates all UUIDv7 identifiers internally
- Emits structured EvaluationReports for every command
- Emits audit events separately (append-only)
- Emits immutable session receipts at structural closure
- Never manages storage, indexing, import, or export
- Enforces governance slot invariants at command boundary

Legitimacy is created only via session acceptance.

Receipts formalize closure and are engine-authoritative artifacts.

Bootstrap is not a special API. Authority initialization occurs through standard session mechanics.

---

# 2. Global Rules

## ENG-API-01 — Deterministic Command Reporting

Every mutating API call must return exactly one EvaluationReport.

Read-only calls return deterministic snapshots.

The Engine must not:

- Throw semantic exceptions
- Return booleans for legitimacy
- Encode meaning in narrative strings

All semantic outcomes must be structured.

---

## ENG-API-02 — UUID Ownership

All IDs are UUIDv7 generated by the Engine:

- session_id
- candidate_id
- resolution_id
- evaluation_id
- vote_id
- receipt_id

The caller may reference existing IDs but may not create them.

---

## ENG-API-03 — No Implicit Legitimacy

No API call may:

- Create legitimacy outside acceptance
- Supersede resolutions directly
- Mutate immutable objects
- Auto-close sessions
- Bypass governance preconditions

Supersession occurs only as a consequence of successful acceptance.

Receipts never create legitimacy — they formalize closure.

---

# 3. Governance Enforcement at API Boundary

Governance prerequisites must be validated:

- At session creation
- At acceptance attempt

Failure must produce deterministic error codes.

Bootstrap is simply:

create_session(session_type = AUTHORITY)

There is no separate bootstrap_authority API.

CLI orchestration does not alter engine mechanics.

---

## 3.1 Deterministic Governance Error Codes

The Engine must use structured error codes for governance violations:

- GOVERNANCE_NOT_INITIALIZED
- AUTHORITY_NOT_DEFINED
- SCOPE_NOT_DEFINED
- GOVERNANCE_SLOT_VIOLATION

These codes must be:

- Deterministic
- Stable across implementations
- Independent of runtime timing

No narrative-only failures permitted.

---

# 4. Engine Rehydration & Status

## 4.1 rehydrate_engine

Load a complete domain graph into memory.

Inputs:

- domain_objects
  - sessions
  - candidates
  - votes
  - resolutions
  - scopes
  - receipts
  - annotations

Behavior:

- Validates structural integrity
- Validates governance slot exclusivity
- Validates supersession graph
- Validates receipt integrity (content_hash, snapshot consistency)
- Validates participant sets
- Enforces BLOCK_PERMANENT hygiene
- Derives Area governance state (not stored)

Non-mutating with respect to storage.

Returns:

- EvaluationReport summarizing readiness or invariant violations

Fail if:

- Multiple ACTIVE Authority in an Area
- Multiple ACTIVE Scope in an Area
- Required slot missing given existing sessions
- Receipt content_hash mismatch
- Structural invariant violated

---

# 5. Read-Only Queries

## 5.1 list_sessions

Returns deterministic session snapshots:

- session_id
- session_type
- state
- phase
- participant_ids
- candidate_ids

---

## 5.2 list_resolutions

Returns deterministic resolution snapshots:

- resolution_id
- state
- superseded_by
- participant_snapshot
- candidate_snapshot

---

## 5.3 get_session_state

Inputs:

- session_id

Returns:

- Complete session object

---

## 5.4 get_resolution_state

Inputs:

- resolution_id

Returns:

- Complete resolution object

---

## 5.5 get_session_receipt

Inputs:

- session_id

Returns:

- Canonical immutable receipt

Fail if:

- No receipt exists

---

## 5.6 list_session_receipts

Returns:

- All receipts
- Deterministically ordered by receipt_id (UUIDv7 order)

Includes:

- LEGITIMACY
- EXPLORATION

---

# 6. Session Lifecycle Commands

## 6.1 create_session

Inputs:

- session_type (AUTHORITY | SCOPE | REGULAR)
- participants (initial set)
- annotations (optional)

Behavior:

- Generates session_id
- Snapshots Authority and Scope per governance rules
- Validates governance prerequisites

Creation Rules:

AUTHORITY session:

- Allowed if no ACTIVE Authority exists
- Or allowed if superseding current Authority under rules
- Otherwise → GOVERNANCE_SLOT_VIOLATION

SCOPE session:

- Requires exactly one ACTIVE Authority
- Otherwise → AUTHORITY_NOT_DEFINED

REGULAR session:

- Requires exactly one ACTIVE Authority
- Requires exactly one ACTIVE Scope
- Missing Authority → AUTHORITY_NOT_DEFINED
- Missing Scope → SCOPE_NOT_DEFINED
- Both missing → GOVERNANCE_NOT_INITIALIZED

No side effects occur if governance validation fails.

---

## 6.2 pause_session
## 6.3 resume_session
## 6.4 close_session
## 6.5 add_participant
## 6.6 remove_participant
## 6.7 add_candidate
## 6.8 remove_candidate
## 6.9 record_vote

All lifecycle mutation commands:

- Enforce phase and state invariants
- Return structured EvaluationReport
- Must not mutate on invariant failure

---

## 6.10 attempt_acceptance

Inputs:

- session_id

Behavior:

- Performs full validation independent of prior evaluation
- Validates governance preconditions
- Validates Authority usability
- Validates Scope usability
- Validates constraints
- Evaluates votes
- Performs atomic commit

Acceptance must not depend on prior evaluate_session calls.

On success:

- Create Resolution
- Transition session → ACCEPTED
- Emit LEGITIMACY receipt

On failure:

- No mutation
- Deterministic error code

Acceptance must not proceed if governance prerequisites fail.

---

# 7. Read-Only Evaluation

## 7.1 evaluate_session

Inputs:

- session_id

Behavior:

- Pure and strictly non-mutating
- Idempotent
- Deterministic
- May be invoked in any session state (including BLOCK_TEMPORARY or BLOCK_PERMANENT)
- Must not alter session state
- Must not alter resolution state
- Must not emit receipts
- Must not emit audit events
- Must not trigger lifecycle transitions
- Must not insert implicit votes
- Must not normalize or rewrite domain objects
- Must not trigger revalidation that mutates state

Returns:

- EvaluationReport with:
  - can_accept
  - blocking_reasons
  - governance violations
  - constraint violations

Repeated calls with identical domain state must produce identical EvaluationReports (excluding non-semantic diagnostics).

Evaluation is simulation only.

Acceptance is transaction.

---

# 8. Import / Restore Support

## 8.1 validate_imported_area

Structural validation only.

Must validate:

- Governance slot exclusivity
- Required slot presence
- Receipt integrity
- Snapshot alignment
- Supersession graph

No mutation permitted.

---

## 8.2 simulate_restore

Non-mutating preview of restore impact.

Must not:

- Generate new receipts
- Modify existing receipts

---

# 9. Bulk DAG Export

## 9.1 export_area_dag

Behavior:

- Returns a complete deterministic DAG snapshot of the Area:

  - sessions (all states)
  - resolutions
  - candidates
  - votes
  - scopes
  - active Authority and Scope
  - receipts
  - annotations

- Deterministic ordering ensures identical output from identical state
- Read-only
- No mutation occurs during export
- Conforms to ENG-DOMAIN object schemas

Returns:

- Full area DAG object, canonical and immutable for the duration of the export
- Compatible with rehydration APIs for import into another engine instance

Fail if:

- Any object references missing or structurally invalid

---

# 10. Blocking Semantics

Blocking is engine-detected only.

Receipts record closure but never trigger blocking.

Area-wide BLOCK_PERMANENT enforcement occurs during acceptance attempts.

Evaluation may report blocking but must not change blocking state.

---

# 11. Final Guarantees

- Governance preconditions enforced at API boundary
- Bootstrap uses standard AUTHORITY session
- No special-case APIs
- Supersession occurs only via acceptance
- Receipts immutable and deterministic
- Governance slots exclusive per Area
- Restore validates slot presence and exclusivity
- Evaluation is pure, idempotent, and non-mutating
- Acceptance does not depend on prior evaluation
- Bulk DAG export available and deterministic
- All error responses deterministic
- Engine storage, import, export remain caller responsibilities

---

# Mental Model

The Engine is a legitimacy compiler.

The API is a mechanical boundary.

Governance must exist before legitimacy may be created.

Evaluation inspects.
Acceptance commits.
Supersession evolves governance.
Receipts freeze closure.

Everything deterministic.
Nothing implicit.
Nothing inferred.
Nothing auto-repaired.