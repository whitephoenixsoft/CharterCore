# ENG-API — Minimal Engine Interface Specification  
Status: FROZEN (v3 – Solo Mode + Rehydration + Receipts)  
Applies to: Engine Core (V1 Solo Mode)  
Scope: Deterministic, storage-agnostic engine interface  

Authority: Subordinate to ENG-DOMAIN, ENG-ERROR, ENG-CORE-PURITY, ENG-REVIEW-RETIRED, ENG-SUPERSESSION, ENG-RECEIPT  

---

# 1. Purpose

ENG-API defines the minimal deterministic interface between a host (CLI or other caller) and the Engine Core.

The Engine:

- Operates only on canonical domain objects  
- Generates all UUIDv7 identifiers internally  
- Emits structured EvaluationReports for every command  
- Emits audit events separately (append-only)  
- Emits immutable session receipts at structural closure  
- Never manages storage, indexing, import, or export  

Legitimacy is created only via session acceptance.

Receipts formalize closure and are engine-authoritative artifacts.

---

# 2. Global Rules

## ENG-API-01 — Deterministic Evaluation

Every mutating API call must return exactly one EvaluationReport (see ENG-ERROR).

Read-only calls return deterministic snapshots.

The Engine must not:

- Throw semantic exceptions  
- Return booleans for legitimacy  
- Encode meaning in narrative strings  

---

## ENG-API-02 — UUID Ownership

All IDs are UUIDv7 generated by the Engine:

- session_id  
- candidate_id  
- resolution_id  
- evaluation_id  
- vote_id  
- receipt_id  

The caller may reference existing IDs but may not create them.

---

## ENG-API-03 — No Implicit Legitimacy

No API call may:

- Create legitimacy outside acceptance  
- Supersede resolutions directly  
- Mutate immutable objects  
- Auto-close sessions  

Supersession occurs only as a consequence of successful acceptance.

Receipts never create legitimacy — they formalize closure.

---

# 3. Engine Rehydration & Status

## 3.1 rehydrate_engine

Load a complete domain graph into memory for evaluation.

Inputs:

- domain_objects  
  - sessions  
  - candidates  
  - votes  
  - resolutions  
  - scopes  
  - receipts  
  - annotations  

Behavior:

- Validates structural integrity  
- Validates supersession graph  
- Validates receipt integrity (content_hash, snapshot consistency)  
- Validates participant sets  
- Enforces BLOCK_PERMANENT hygiene  
- Initializes in-memory evaluation context  

Non-mutating with respect to storage.

Returns:

- EvaluationReport summarizing readiness or invariant violations

Fail if:

- Receipt content_hash does not match canonical content  
- Receipt references invalid session state  
- Structural invariants are violated  

---

## 3.2 list_sessions

Returns read-only session snapshots:

- session_id  
- state  
- phase  
- participant_ids  
- candidate_ids  

---

## 3.3 list_resolutions

Returns read-only resolution snapshots:

- resolution_id  
- state  
- superseded_by  
- participant_snapshot  
- candidate_snapshot  

---

## 3.4 get_session_state

Inputs:

- session_id  

Returns:

- Complete session object  
  - phase  
  - state  
  - participants  
  - candidates  
  - votes  
  - constraints  
  - annotations  

---

## 3.5 get_resolution_state

Inputs:

- resolution_id  

Returns:

- Complete resolution object  

---

# 4. Session Receipts (Read-Only)

Receipts are immutable engine artifacts created at session closure.

They are not audit events.

---

## 4.1 get_session_receipt

Inputs:

- session_id  

Returns:

- Canonical session receipt including:
  - receipt_id  
  - receipt_type  
  - session_id  
  - participant_snapshot  
  - candidate_snapshot  
  - stance_snapshot  
  - participant_reconfirmation history  
  - acceptance_result  
  - session_state_at_close  
  - content_hash  
  - created_at  

Fail if:

- No receipt exists for session  

---

## 4.2 list_session_receipts

Inputs:

- None  

Returns:

- All receipts currently loaded in the rehydrated domain graph  
- Ordered deterministically by receipt_id (UUIDv7 ordering)

Includes:

- LEGITIMACY receipts  
- EXPLORATION receipts  

---

# 5. Audit Interaction

## 5.1 list_audit_events

## 5.2 get_audit_event

Audit remains:

- Append-only  
- Non-legitimizing  
- Observability-focused  

Audit may reference receipt_id.  
Receipts must never depend on audit ordering.

---

# 6. Session Lifecycle

(Unchanged: create_session, pause_session, resume_session, close_session, participant management, candidate management, voting, attempt_acceptance)

Clarification:

Upon:

- ACCEPTED → Engine MUST generate LEGITIMACY receipt  
- CLOSED without acceptance → Engine MUST generate EXPLORATION receipt  

Receipt generation is atomic with state transition.

---

# 7. Read-Only Evaluation

## 7.1 evaluate_session

Inputs:

- session_id  

Behavior:

- Non-mutating  
- Returns EvaluationReport with acceptance feasibility, blocking conditions, constraint violations  

Must not:

- Insert implicit solo vote  
- Generate receipt  
- Emit legitimacy  

---

# 8. Import / Restore Support

## 8.1 validate_imported_area

Inputs:

- domain_objects  

Behavior:

- Structural validation only  
- Validate receipt integrity  
- Validate snapshot alignment between receipts and sessions  
- Validate content_hash correctness  

No mutation permitted.

---

## 8.2 simulate_restore

Inputs:

- domain_objects  

Behavior:

- Non-mutating preview of restore impact  
- Must not generate new receipts  
- Must not modify existing receipts  

---

# 9. Blocking Semantics

Blocking is engine-detected only.

Receipts record closure state but never trigger blocking.

---

# 10. Final Guarantees

- Supersession occurs only via session acceptance  
- Receipts are immutable and deterministic  
- Receipts are included in restore graphs  
- Receipt integrity is validated during rehydration  
- Blocking is engine-detected  
- Solo mode remains degenerate voting case  
- All operations deterministic  
- Engine storage, import, export remain caller responsibilities  
- CLI may rehydrate engine per execution  

---

# Mental Model

The Engine is a legitimacy compiler.

Sessions define context.  
Votes define evaluation.  
Acceptance defines legitimacy.  
Receipts freeze closure.  
Audit observes activity.  

Everything is deterministic.  
Nothing changes unless explicitly commanded.