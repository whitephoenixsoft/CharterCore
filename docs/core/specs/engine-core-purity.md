# ENG-CORE-PURITY — Engine Isolation & Determinism Principles
Status: FROZEN (v3 – Cross-Area Opacity Doctrine Added)
Applies to: Engine Core (V1/V2+)
Scope: Constitutional Engine Guarantees

---

# 1. Purpose

This document defines the isolation, identity, locality, and determinism principles of the Engine Core.

It establishes what the engine is allowed to depend on, and what it must never depend on.

This specification is constitutional.

If violated, legitimacy integrity is compromised.

---

# 2. Engine Isolation Model

## ENG-CORE-01 — Storage Agnostic

The Engine:

- Does not read from storage directly.
- Does not write to storage directly.
- Does not compute or validate file hashes.
- Does not validate persistence envelopes.
- Does not manage area lifecycle.

Persistence is the responsibility of the caller (e.g., CLI layer).

Fail if:

- Engine behavior depends on storage layout.
- Engine traverses physical persistence structures.
- Engine derives legitimacy from storage presence.

---

## ENG-CORE-02 — Logical Input Boundary

The Engine operates only on:

- Domain objects provided as input.
- Explicit structural references between those objects.
- Defined lifecycle state.
- Defined authority and scope rules.

The Engine must not:

- Infer missing objects.
- Traverse undeclared relationships.
- Derive meaning from object existence alone.
- Resolve external or cross-area identifiers.

Fail if:

- Mere existence of an object affects legitimacy.
- Unreferenced objects influence evaluation.
- Implicit graph traversal alters outcomes.
- External area presence or absence affects legitimacy.

---

# 3. Structural Locality Doctrine

## ENG-CORE-03 — Area Sovereignty

Each Area is structurally sovereign.

Legitimacy within an Area must be computable from:

- That Area’s domain objects only.
- Supersession relationships within that Area.
- Governance state derived within that Area.

The Engine must not:

- Depend on other Areas for legitimacy computation.
- Traverse cross-area references.
- Require external Areas to exist.

Fail if:

- Removal of an external Area alters legitimacy of a local Area.
- Cross-area existence influences ACTIVE derivation.
- Federation topology affects evaluation outcome.

---

# 4. Identity Doctrine

## ENG-CORE-04 — Engine-Owned Identity

All domain object identifiers:

- Must be generated by the Engine.
- Must be UUID version 7.
- Must be immutable once assigned.

External systems:

- Must not inject domain object identifiers.
- Must not override engine identity generation.

UUID timestamp components:

- Must not influence legitimacy.
- Must not determine supersession precedence.
- Must not determine restore ordering.

Fail if:

- Identity depends on storage.
- Identity depends on import source.
- Timestamp ordering affects governance outcome.

---

# 5. Immutability Principle

## ENG-CORE-05 — No In-Place Mutation

Domain objects:

- Must never be modified after creation.
- May only transition via explicit state changes defined in domain specs.
- May only evolve via supersession where defined.

History must never be rewritten.

Fail if:

- Objects are mutated in place.
- Supersession edges are altered after creation.
- State transitions occur implicitly.

---

# 6. Structural Reference Boundary

## ENG-CORE-06 — Supersession Is the Only Structural Graph Edge

Within an Area, the only structural inter-object graph edge that affects legitimacy is:

- Supersession between Resolutions.

No other domain object references may:

- Affect ACTIVE derivation.
- Create structural dependency.
- Influence legitimacy computation.

If additional internal references are introduced in future specifications, they must explicitly declare:

- Whether they are structural or informational.
- Their legitimacy impact.
- Their integrity validation rules.

Fail if:

- An undeclared reference alters legitimacy.
- Informational references are treated as structural.

---

# 7. Cross-Area Opacity Doctrine

## ENG-CORE-07 — Cross-Area References Are Informational Only

Domain objects may contain cross-area references to:

- External Areas.
- External Resolutions.

A cross-area reference must contain:

- An external identifier (e.g., area_id and optionally resolution_id).
- A human-readable label snapshot.

Cross-area references:

- Are opaque identifiers.
- Are not dereferenced by the Engine.
- Are not validated for existence.
- Are not structural graph edges.
- Do not participate in supersession.
- Do not affect ACTIVE derivation.
- Do not affect governance slot evaluation.
- Do not affect restore validation.

The Engine must not:

- Require the referenced Area to exist.
- Fail restore due to unresolved cross-area references.
- Treat missing external targets as ORPHAN or MISSING_REFERENCE.
- Attempt to update or canonicalize labels.

Deletion or absence of a referenced external Area or Resolution must not alter:

- Session state.
- Resolution state.
- Blocking state.
- Acceptance eligibility.

Fail if:

- Cross-area references influence legitimacy.
- Cross-area references create structural dependency.
- External availability affects deterministic evaluation.

---

# 8. Determinism Guarantee

## ENG-CORE-08 — Pure Deterministic Evaluation & Mutation

Given identical:

- Domain objects
- Structural references
- Session state
- Authority state
- Scope state

The Engine must produce identical outcomes.

No behavior may depend on:

- Hash algorithm
- Serialization format
- Storage order
- Import source
- Runtime environment
- System clock (beyond UUID generation)
- External system availability

Fail if:

- Two independent implementations produce different results from identical inputs.

---

# 9. Evaluation Purity Doctrine

## ENG-CORE-09 — Evaluation Is Pure and Side-Effect Free

Evaluation APIs (e.g., evaluate_session):

- Must be strictly non-mutating.
- Must not alter session state.
- Must not alter resolution state.
- Must not emit receipts.
- Must not emit audit events.
- Must not trigger lifecycle transitions.
- Must not insert implicit votes.
- Must not normalize or rewrite domain objects.
- Must not traverse cross-area references.

Evaluation must not:

- Cause BLOCK_TEMPORARY or BLOCK_PERMANENT transitions.
- Recompute and persist derived state.
- Modify participant or candidate sets.

Fail if:

- Any engine state changes during evaluation.
- Evaluation alters future acceptance behavior.

---

## ENG-CORE-10 — Evaluation Idempotence

Evaluation must be idempotent.

Given identical:

- Domain graph
- Session state
- Authority and Scope state

Repeated evaluation calls must produce identical EvaluationReports (except non-semantic diagnostics).

Acceptance must independently validate all invariants without reliance on prior evaluation.

Fail if:

- Evaluation changes output across repeated identical calls.
- Acceptance correctness depends on prior evaluation invocation.

---

# 10. Legitimacy Boundary

## ENG-CORE-11 — Legitimacy Is Structural and Local

Legitimacy is created only through:

- Sessions
- Acceptance rules
- Supersession rules within an Area

Legitimacy is not created by:

- Evaluation
- Audit events
- Storage operations
- Import actions
- Timestamps
- Actor identity
- Cross-area references

Fail if:

- Legitimacy can be inferred without session acceptance.
- Evaluation creates governance effects.
- Audit substitutes for governance.
- Persistence implies authority.
- External Areas influence legitimacy.

---

# 11. Non-Goals

The Engine is not:

- A storage engine
- A version control system
- A hash registry
- A permission system
- A distributed consensus protocol
- A cross-area integrity validator

The Engine is:

A deterministic, Area-local legitimacy evaluator.

---

# 12. Mental Model

- Storage remembers.
- Audit records.
- CLI orchestrates.
- Evaluation inspects.
- Acceptance commits.
- Supersession evolves governance.
- Areas are sovereign.

The Engine is a legitimacy compiler.

Evaluation is simulation.
Acceptance is transaction.
Cross-area references are context only.

---

# 13. Constitutional Status

This document defines the isolation and locality boundary of the Engine Core.

All other specifications (ENG-DOMAIN, ENG-DECISION, ENG-REVIEW-RETIRED, ENG-SUPERSESSION, ENG-AUD, ENG-API, ENG-INTEGRITY) must conform to these principles.

Violation of these principles constitutes a critical constitutional failure.